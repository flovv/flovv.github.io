rmd2md <- function( path_site = getwd(),
dir_rmd = "_rmd",
dir_md = "_posts",
#dir_images = "figures",
url_images = "figures/",
out_ext='.md',
in_ext='.rmd',
recursive=FALSE) {
require(knitr, quietly=TRUE, warn.conflicts=FALSE)
#andy change to avoid path problems when running without sh on windows
files <- list.files(path=file.path(path_site,dir_rmd), pattern=in_ext, ignore.case=TRUE, recursive=recursive)
for(f in files) {
message(paste("Processing ", f, sep=''))
content <- readLines(file.path(path_site,dir_rmd,f))
frontMatter <- which(substr(content, 1, 3) == '---')
if(length(frontMatter) >= 2 & 1 %in% frontMatter) {
statusLine <- which(substr(content, 1, 7) == 'status:')
publishedLine <- which(substr(content, 1, 10) == 'published:')
if(statusLine > frontMatter[1] & statusLine < frontMatter[2]) {
status <- unlist(strsplit(content[statusLine], ':'))[2]
status <- sub('[[:space:]]+$', '', status)
status <- sub('^[[:space:]]+', '', status)
if(tolower(status) == 'process') {
#This is a bit of a hack but if a line has zero length (i.e. a
#black line), it will be removed in the resulting markdown file.
#This will ensure that all line returns are retained.
content[nchar(content) == 0] <- ' '
message(paste('Processing ', f, sep=''))
content[statusLine] <- 'status: publish'
content[publishedLine] <- 'published: true'
#andy change to path
outFile <- file.path(path_site, dir_md, paste0(substr(f, 1, (nchar(f)-(nchar(in_ext)))), out_ext))
#render_markdown(strict=TRUE)
#render_markdown(strict=FALSE) #code didn't render properly on blog
#andy change to render for jekyll
render_jekyll(highlight = "pygments")
#render_jekyll(highlight = "prettify") #for javascript
opts_knit$set(out.format='markdown')
# andy BEWARE don't set base.dir!! it caused me problems
# "base.dir is never used when composing the URL of the figures; it is
# only used to save the figures to a different directory.
# The URL of an image is always base.url + fig.path"
# https://groups.google.com/forum/#!topic/knitr/18aXpOmsumQ
opts_knit$set(base.url = "/")
opts_chunk$set(fig.path = url_images)
#andy I could try to make figures bigger
#but that might make not work so well on mobile
#opts_chunk$set(fig.width  = 8.5,
#               fig.height = 5.25)
try(knit(text=content, output=outFile), silent=FALSE)
} else {
warning(paste("Not processing ", f, ", status is '", status,
"'. Set status to 'process' to convert.", sep=''))
}
} else {
warning("Status not found in front matter.")
}
} else {
warning("No front matter found. Will not process this file.")
}
}
invisible()
}
rmd2md()
rmd2md()
rmd2md()
rmd2md()
rmd2md()
rmd2md()
# Minimal break-even calculator
break_even_lift <- function(ctr0, cr0, margin0, cpm0,
reach_share, cpm_target, data_cost = 0,
impressions = 1e6) {
p0 <- impressions * ctr0 * cr0 * margin0 - (cpm0 * impressions / 1000)
denom <- impressions * reach_share * ctr0 * cr0 * margin0
cost_target <- (cpm_target + data_cost) * impressions * reach_share / 1000
lift <- (p0 + cost_target) / denom
lift
}
# Example baseline (close to the paper's illustrative values)
ctr0 <- 0.01
cr0 <- 0.02
margin0 <- 200
cpm0 <- 11
segments <- data.frame(
segment = c("broad", "mid", "narrow"),
reach_share = c(0.50, 0.20, 0.05),
cpm_target = c(11, 11, 11),
data_cost = c(1.0, 1.0, 1.0)
)
segments$break_even_lift <- mapply(
break_even_lift,
ctr0 = ctr0,
cr0 = cr0,
margin0 = margin0,
cpm0 = cpm0,
reach_share = segments$reach_share,
cpm_target = segments$cpm_target,
data_cost = segments$data_cost
)
# Minimal break-even calculator
break_even_lift <- function(ctr0, cr0, margin0, cpm0,
reach_share, cpm_target, data_cost = 0,
impressions = 1e6) {
p0 <- impressions * ctr0 * cr0 * margin0 - (cpm0 * impressions / 1000)
denom <- impressions * reach_share * ctr0 * cr0 * margin0
cost_target <- (cpm_target + data_cost) * impressions * reach_share / 1000
lift <- (p0 + cost_target) / denom
lift
}
# Example baseline (close to the paper's illustrative values)
ctr0 <- 0.01
cr0 <- 0.02
margin0 <- 200
cpm0 <- 11
segments <- data.frame(
segment = c("broad", "mid", "narrow"),
reach_share = c(0.50, 0.20, 0.05),
cpm_target = c(11, 11, 11),
data_cost = c(1.0, 1.0, 1.0)
)
segments$break_even_lift <- mapply(
break_even_lift,
ctr0 = ctr0,
cr0 = cr0,
margin0 = margin0,
cpm0 = cpm0,
reach_share = segments$reach_share,
cpm_target = segments$cpm_target,
data_cost = segments$data_cost
)
segments
library(ggplot2)
reach <- seq(0.05, 1.0, length.out = 200)
plot_df <- data.frame(
reach_share = reach,
break_even_lift = sapply(reach, function(r) {
break_even_lift(
ctr0 = ctr0,
cr0 = cr0,
margin0 = margin0,
cpm0 = cpm0,
reach_share = r,
cpm_target = 11,
data_cost = 1.0
)
})
)
ggplot(plot_df, aes(x = reach_share, y = break_even_lift)) +
geom_line(color = "#1f77b4", linewidth = 1) +
geom_hline(yintercept = 2.0, linetype = "dashed", color = "gray60") +
annotate("text", x = 0.95, y = 2.05, label = "100% lift",
hjust = 1, size = 3, color = "gray50") +
labs(
title = "Break-even performance increases non-linearly as reach shrinks",
x = "Reach share of target segment",
y = "Required combined lift (CTR * CR * margin)"
) +
theme_minimal(base_size = 11)
install.packages("ggplot2")
ggplot(plot_df, aes(x = reach_share, y = break_even_lift)) +
geom_line(color = "#1f77b4", linewidth = 1) +
geom_hline(yintercept = 2.0, linetype = "dashed", color = "gray60") +
annotate("text", x = 0.95, y = 2.05, label = "100% lift",
hjust = 1, size = 3, color = "gray50") +
labs(
title = "Break-even performance increases non-linearly as reach shrinks",
x = "Reach share of target segment",
y = "Required combined lift (CTR * CR * margin)"
) +
theme_minimal(base_size = 11)
library(ggplot2)
reach <- seq(0.05, 1.0, length.out = 200)
plot_df <- data.frame(
reach_share = reach,
break_even_lift = sapply(reach, function(r) {
break_even_lift(
ctr0 = ctr0,
cr0 = cr0,
margin0 = margin0,
cpm0 = cpm0,
reach_share = r,
cpm_target = 11,
data_cost = 1.0
)
})
)
ggplot(plot_df, aes(x = reach_share, y = break_even_lift)) +
geom_line(color = "#1f77b4", linewidth = 1) +
geom_hline(yintercept = 2.0, linetype = "dashed", color = "gray60") +
annotate("text", x = 0.95, y = 2.05, label = "100% lift",
hjust = 1, size = 3, color = "gray50") +
labs(
title = "Break-even performance increases non-linearly as reach shrinks",
x = "Reach share of target segment",
y = "Required combined lift (CTR * CR * margin)"
) +
theme_minimal(base_size = 11)
ggplot(plot_df, aes(x = reach_share, y = break_even_lift)) +
geom_line(color = "#1f77b4", linewidth = 1) +
geom_hline(yintercept = 2.0, linetype = "dashed", color = "gray60") +
annotate("text", x = 0.95, y = 2.05, label = "100% lift",
hjust = 1, size = 3, color = "gray50") +
labs(
title = "Break-even performance increases non-linearly as reach shrinks",
x = "Reach share of target segment",
y = "Required combined lift (CTR * CR * margin)"
) +
theme_minimal(base_size = 14)
ggplot(plot_df, aes(x = reach_share, y = break_even_lift)) +
geom_line(color = "#1f77b4", linewidth = 1) +
geom_hline(yintercept = 2.0, linetype = "dashed", color = "gray60") +
annotate("text", x = 0.95, y = 2.05, label = "100% lift",
hjust = 3, size = 3, color = "gray50") +
labs(
title = "Break-even performance increases non-linearly as reach shrinks",
x = "Reach share of target segment",
y = "Required combined lift (CTR * CR * margin)"
) +
theme_minimal(base_size = 14)
ggplot(plot_df, aes(x = reach_share, y = break_even_lift)) +
geom_line(color = "#1f77b4", linewidth = 1) +
geom_hline(yintercept = 2.0, linetype = "dashed", color = "gray60") +
annotate("text", x = 0.95, y = 2.05, label = "100% lift",
hjust = 1, vjust= 1.5, size = 3, color = "gray50") +
labs(
title = "Break-even performance increases non-linearly as reach shrinks",
x = "Reach share of target segment",
y = "Required combined lift (CTR * CR * margin)"
) +
theme_minimal(base_size = 14)
# Save the plot
ggsave("figures/post32/targeting-break-even.png", width = 7, height = 4, dpi = 200)
# Save the plot
ggsave("figures/post32/targeting-break-even.png", width = 9, height = 6, dpi = 200)
